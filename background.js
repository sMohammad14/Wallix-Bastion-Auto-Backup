function setIconBasedOnState() {chrome.storage.local.get(['locked'], (result) => {const isScheduled = result.locked === true;const iconPath = isScheduled ? {16: "icons/icon-color-16.png",32: "icons/icon-color-32.png",48: "icons/icon-color-48.png",128: "icons/icon-color-128.png"} : {16: "icons/icon-gray-16.png",32: "icons/icon-gray-32.png",48: "icons/icon-gray-48.png",128: "icons/icon-gray-128.png"};chrome.action.setIcon({ path: iconPath }).catch(error => {});});}setIconBasedOnState();chrome.storage.onChanged.addListener((changes, area) => {if (area === 'local' && changes.locked) {setIconBasedOnState();}});chrome.alarms.onAlarm.addListener(async (alarm) => {if (alarm.name === "backupAlarm") {const data = await chrome.storage.local.get(['url', 'user', 'pass', 'secret']);if (data.url) {await chrome.storage.local.set({ active: true });chrome.tabs.create({ url: data.url + "/ui/system/backup-restore" });}}});chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {if (request.action === "DOWNLOAD_FILE") {chrome.downloads.download({url: request.url,filename: request.filename,conflictAction: "uniquify"});}if (request.action === "CLOSE_TAB") {chrome.tabs.remove(sender.tab.id);}sendResponse({ received: true });});
